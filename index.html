<!DOCTYPE html>

<html>

    <head>

        <title>Experiment</title>
        <script src="jspsych-6.0.5/jspsych.js"></script>
        <script src="jspsych-6.0.5/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.0.5/plugins/jspsych-html-button-response.js"></script>
        <script src="jspsych-6.0.5/plugins/jspsych-image-keyboard-response.js"></script>
        <script src="jspsych-6.0.5/plugins/jspsych-audio-keyboard-response.js"></script>
        <script src="jspsych-6.0.5/plugins/jspsych-image-slider-response.js"></script>
        <script src="jspsych-6.0.5/plugins/jspsych-fullscreen.js"></script>
        <script src="jspsych-6.0.5/plugins/jspsych-video.js"></script>
        <link href="jspsych-6.0.5/css/jspsych.css" rel="stylesheet" type="text/css"></link>

    </head>

    <body></body>
	<script>

	    /* create timeline */
	    var timeline = [];

	    /* define welcome message trial */
	    var welcome = {
	      type: "html-keyboard-response",
	      stimulus: "Welcome to the experiment!" + "<br><br><br>(To continue: Press SPACE)" + "<br>(To abort: Close this window)"
	      	    };
		timeline.push(welcome);

	    /* Consent form */
        var consent = {
            type: "html-keyboard-response",
            stimulus: "<p>INFORMED CONSENT TO PARTICIPATE IN A RESEARCH PROJECT: FACTORS INFLUENCING AUDITORY PERCEPTION</p><br>A research project on auditory perception is being conducted by Dr. Laura Cacciamani in the Department of Psychology and Child Development at Cal Poly, San Luis Obispo. The purpose of the study is to understand the factors that can influence one’s perception of ambiguous musical patterns. <br><br>In this study, you will be asked to listen to various musical notes and make simple responses about what you hear. Afterwards, you will be given a short questionnaire regarding your experience during the experiment. Your participation will take up to approximately 30 minutes. Please be aware that you are not required to participate in this research, you may omit any items you prefer not to answer on the questionnaire, and you may discontinue your participation at any time. <br><br>There are no risks anticipated with your participation; however, if you should experience any psychological discomfort, please be aware that you may discontinue the experiment, and contact Counseling Services at (805) 756-2511 for assistance, if necessary. <br> Your confidentiality will be protected by de-identifying all data, which means that your name will not be associated with your performance on the task or responses on the questionnaire. Potential benefits associated with the study include contributing to scientific research on factors that can influence auditory perception under ambiguous conditions. If you signed up for this study as part of a course, you may earn 1 research participation credit through the online SONA system, or extra credit for a course (a minimal amount pre-determined by your instructor); if you do not complete the experiment, you may not receive this credit. If you signed up for this study for extra credit and no longer choose to participate, you will be offered the opportunity to earn an equal amount of extra credit through your instructor. If you signed up for this study as a volunteer (not as part of a course), you will not receive any incentive for your participation. <br><br> If you have questions regarding this study or would like to be informed of the results when the study is completed, please feel free to contact Dr. Laura Cacciamani at Lcacciam@calpoly.edu. If you have concerns regarding the manner in which the study is conducted, you may contact Dr. Michael Black, Chair of the Cal Poly Institutional Review Board, at (805) 756-2894, mblack@calpoly.edu, or Ms. Trish Brock, Director of Research Compliance, at (805) 756-1450 or pbrock@calpoly.edu.<br><br> If you agree to voluntarily participate in this research project as described, please indicate your agreement by pressing SPACE to continue. Thank you for your participation in this research. <br><br>",
            choices: ' '
        };
        timeline.push(consent);
        
        /* define instructions trial */
	    var instructions = {
            timeline: [
            {
                   type: 'html-keyboard-response',
                   stimulus: "<p>INSTRUCTIONS:</p>" + "<p>For this experiment, please make sure that you are in a quiet, distraction-free space where you can focus for the next 10 minutes. This study should be done on a laptop or desktop computer; if you are using a smartphone or small tablet, please close this window, and re-open on a computer. <br><br> This study involves an auditory component, so please take a moment to make sure your volume is up. If you have headphones available to you, please put them on now. Please also turn your screen brightness up to 100% for the duration of this experiment. <br><br> (Press SPACE to continue reading instructions) </p> "
            },
            {
                   type: 'html-keyboard-response',
                   stimulus: "<p>INSTRUCTIONS:</p>" + "<br><p>In this experiment, you'll hear two consecutive musical tones.</p> " +
                   "<p>The tones are designed to sound ambiguous, like an illusion. The tones can either be heard as ascending (from low to high) or descending (from high to low) in pitch.</p> " +
                    "<p>Press SPACE to hear an example...</p> "
            },
            {
                   type: 'video',
                   sources: ['stim/A-D_ascending.mp4'],
                   autoplay: true,
                   height: 1,
                   width: 1,
                   prompt: "<p>(listen)</p>"
            },
                       {
                       type: 'html-keyboard-response',
                       stimulus: "<p>Did you hear those two notes? (If not, please check your volume again before continuing.) <br>You may have heard the two notes as ascending or descending. Neither answer is correct; people hear it different ways, that's why it's an illusion.</p>" + "<br> (Press SPACE to continue reading instructions)"
                       },
                       {
                       type: 'html-keyboard-response',
                       stimulus: "Each trial will begin with a fixation cross in the middle of the screen that looks like this:" +
                       "<p>+</p>" +
                       "<p>When you see this cross, please look directly at it, and press SPACE whenever you are ready to begin the trial.</p>" + "(Press SPACE to continue reading instructions)"
                       },
                       {
                       type: 'html-keyboard-response',
                       stimulus: "After the fixation cross, you'll hear two tones like the ones you just heard." +
                       "<br><p>If you heard the tones as <strong>ascending</strong>, press J </p> " +
                       "<p>If you heard the tones as <strong>descending</strong>, press F </p> " +
                       "<p>Make sure to respond based on what you <strong>hear.</strong></p> " +
                       "<p>Please rest your index fingers on these keys (with your thumbs on the space bar) for the duration of the experiment to make it easy to respond.</p>" +
                       "<br><p>Remember, this is an auditory illusion, so there are no right or wrong answers. </p>" +
                       "<p>Just respond quickly with your initial gut response.</p>" +
                       "<p>After you respond, the fixation cross for the next trial will appear within a few seconds. There will be 24 trials total with a short pause half-way through.</p>" +
                       "<p>(Press SPACE to continue reading instructions)</p>"
                       }
                       ]
        }
	    timeline.push(instructions);
		

	    /* test trials begin, go fullscreen */
        var go_fullscreen = {
            type: 'fullscreen',
            fullscreen_mode: true,
            message: "<p>Click continue when you're ready to begin the experiment.</p>"
        }
        timeline.push(go_fullscreen);
        
        /* This is the neutral block  */
		var procedure = {
		    timeline: [
                       {
                       type: 'html-keyboard-response',
                       stimulus: '<div style="font-size:60px;">+</div>' + '<br>(Press SPACE to begin trial)',
                       choices: ' ',
                       response_ends_trial: true
                       },
                       {
                       type: 'audio-keyboard-response', /*THIS IS THE tritone stimuli*/
                       stimulus: jsPsych.timelineVariable('stimulus'),
                       choices: ['f', 'j'],
                       prompt: "What did you hear?" + "<br> F = descending" + "<br> J = ascending",
                       response_ends_trial: true,
                       data: {correct_response: 'j', test_part: 'neutral'},
                       on_finish: function(data){
                       data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);}
                       },
                       {
                       type: 'html-keyboard-response',
                       stimulus: " ",
                       choices: jsPsych.NO_KEYS,
                       trial_duration: 2000,
                       }
		    ],
            timeline_variables: [
                                 { stimulus: 'stim/A-D.wav' },
                                 { stimulus: 'stim/A-E.wav' },
                                 { stimulus: 'stim/B-F.wav' },
                                 { stimulus: 'stim/C-F.wav' },
                                 { stimulus: 'stim/C-G.wav' },
                                 { stimulus: 'stim/D-G.wav' },
                                 { stimulus: 'stim/D-A.wav' },
                                 { stimulus: 'stim/E-A.wav' },
                                 { stimulus: 'stim/F-B.wav' },
                                 { stimulus: 'stim/F-C.wav' },
                                 { stimulus: 'stim/G-C.wav' },
                                 { stimulus: 'stim/G-D.wav' }
                                 ],
            randomize_order: true
		}
		timeline.push(procedure);
		
		/* End of neutral block ("part 1"), short break*/
	    var controlinstruct = {
	    	timeline: [
	    		{
	      			type: "html-keyboard-response",
	      			stimulus: "END OF PART 1. <br><br> Press SPACE to continue."
	      	    },
	    		{
	      			type: "html-keyboard-response",
	      			stimulus: "PART 2 <br><br>You will now see 12 more trials just as in Part 1. Press SPACE to begin Part 2."
	      	    }
	      	    ]
	      	  }
		timeline.push(controlinstruct);
		
		/* This begins the neutral2 block */
		var procedurepart2_A = {
            timeline: [
                       {
                       type: 'html-keyboard-response',
                       stimulus: '<div style="font-size:60px;">+</div>' + '<br>(Press SPACE to begin trial)',
                       choices: ' ',
                       response_ends_trial: true
                       },
                       {
                       type: 'audio-keyboard-response', /*THIS WILL BE THE tritone stimuli*/
                       stimulus: jsPsych.timelineVariable('stimulus'),
                       choices: ['j', 'f'],
                       prompt: "What did you hear?" + "<br> F = descending" + "<br> J = ascending",
                       response_ends_trial: true,
                       data: {correct_response: 'j', test_part: 'neutral2'},
                       on_finish: function(data){
                       data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);}
                       },
                       {
                       type: 'html-keyboard-response',
                       stimulus: " ",
                       choices: jsPsych.NO_KEYS,
                       trial_duration: 2000,
                       }
                       ],
            timeline_variables: [
                                 { stimulus: 'stim/A-D.wav' },
                                 { stimulus: 'stim/A-E.wav' },
                                 { stimulus: 'stim/B-F.wav' },
                                 { stimulus: 'stim/C-F.wav' },
                                 { stimulus: 'stim/C-G.wav' },
                                 { stimulus: 'stim/D-G.wav' },
                                 { stimulus: 'stim/D-A.wav' },
                                 { stimulus: 'stim/E-A.wav' },
                                 { stimulus: 'stim/F-B.wav' },
                                 { stimulus: 'stim/F-C.wav' },
                                 { stimulus: 'stim/G-C.wav' },
                                 { stimulus: 'stim/G-D.wav' }
                                 ],
            randomize_order: true
            }
		timeline.push(procedurepart2_A);
		
		function set_bg_color() {
    	document.body.style.backgroundColor = '#ffffff'
		}
		
		/* Sam_V instructions block*/
	    var SAM_V_instruct = {
	    	timeline: [
	    		{
	      			type: "html-keyboard-response",
	      			on_start: set_bg_color,
	      			stimulus: "END OF PART 2. <br><br> Press SPACE to continue."
	      	    },
	    		{
	      			type: "html-keyboard-response",
	      			stimulus: "In this part of the experiment, you’re going to be asked to use a sliding scale to rate how you feel about a few different colors. Before continuing, please double-check that your screen brightness is turned up to 100%." + "<br><br>First, you’ll rate the colors on how unhappy/happy they make you feel. The “unhappy” end of the scale is when you feel completely unhappy, annoyed, unsatisfied, melancholic, despaired, or bored. The “happy” end of the scale is when you feel happy, pleased, satisfied, contented, hopeful." + "<br><br><br>Press SPACE to begin unhappy/happy ratings."
	      	    }
	      	    ]
	      	  }
		timeline.push(SAM_V_instruct);
		

	    /* This is the SAM_V block  */
		var SAM_V = {
			timeline: [
				{
                       type: 'image-slider-response',
                       labels: ['unhappy', 'happy'],
                       stimulus: jsPsych.timelineVariable('stimulus'),
                       prompt: "Please rate this color using the scale above, then click continue.",
                       slider_width: 50,
                       min: 1,
                       max: 9,
                       start: 5,
                       step: 1,
                       data: {test_part: 'SAM_V', color: jsPsych.timelineVariable('color')},
                       response_ends_trial: true
                       }
                       ],
                timeline_variables: [
                				{ stimulus: 'stim/SatRed.png', color: 'SatRed' },
                                 { stimulus: 'stim/DesatRed.png', color: 'DesatRed' },
                                 { stimulus: 'stim/SatYellow.png', color: 'SatYellow' },
                                 { stimulus: 'stim/DesatYellow.png', color: 'DesatYellow' },
                                 { stimulus: 'stim/SatBlue.png', color: 'SatBlue' },
                                 { stimulus: 'stim/DesatBlue.png', color: 'DesatBlue' }
                                 ],
            randomize_order: true
                }
		timeline.push(SAM_V);

	    /* SAM_A instructions */
	    var SAM_A_instruct = {
	      type: "html-keyboard-response",
	      stimulus: "Now, you’re going to be asked to rate the colors on how calm/excited they make you feel. The “calm” end of the scale is when you feel completely relaxed, calm, sluggish, dull, sleepy, or unaroused. The “excited” end of the scale is when you feel completely stimulated, excited, frenzied, jittery, wide-awake, or aroused." + "<br><br><br>Press SPACE to begin these ratings."
	      	    };
		timeline.push(SAM_A_instruct);

	    /* This is the SAM_A block  */
		var SAM_A = {
			timeline: [
				{
                       type: 'image-slider-response',
                       labels: ['calm', 'excited'],
                       stimulus: jsPsych.timelineVariable('stimulus'),
                       prompt: "Please rate this color using the scale above, then click continue.",
                       slider_width: 50,
                       min: 1,
                       max: 9,
                       start: 5,
                       step: 1,
                       data: {test_part: 'SAM_A', color: jsPsych.timelineVariable('color')},
                       response_ends_trial: true
                       }
                       ],
                timeline_variables: [
                				{ stimulus: 'stim/SatRed.png', color: 'SatRed' },
                                 { stimulus: 'stim/DesatRed.png', color: 'DesatRed' },
                                 { stimulus: 'stim/SatYellow.png', color: 'SatYellow' },
                                 { stimulus: 'stim/DesatYellow.png', color: 'DesatYellow' },
                                 { stimulus: 'stim/SatBlue.png', color: 'SatBlue' },
                                 { stimulus: 'stim/DesatBlue.png', color: 'DesatBlue' }
                                 ],
            randomize_order: true
                }
		timeline.push(SAM_A);

        
        // files for preload//
        var audio = ['stim/A-D.wav', 'stim/A-E.wav', 'stim/B-F.wav', 'stim/C-F.wav', 'stim/C-G.wav', 'stim/D-G.wav', 'stim/D-A.wav', 'stim/E-A.wav', 'stim/F-B.wav', 'stim/F-C.wav', 'stim/G-C.wav', 'stim/G-D.wav']
		var images = ['stim/SatRed.png', 'stim/DesatRed.png', 'stim/SatYellow.png', 'stim/DesatYellow.png', 'stim/SatBlue.png', 'stim/DesatBlue.png']

	    /* Debriefing and final instructions */
	    var debrief_block = {
	     	timeline: [
	    		{
	      			type: "html-keyboard-response",
	      			stimulus: "END OF PART 2. <br><br> Press SPACE to continue.",
	      			choices: " ",
	      			on_finish: function() {
                        jsPsych.data.get().filter([{test_part: 'neutral'}, {test_part: 'SAM_V'}, {test_part: 'SAM_A'}, {test_part: 'neutral2'}]).localSave('csv', 'DataFile.csv');
                        }
	      	    },
	    		{
	      			type: "html-keyboard-response",
	      			choices: jsPsych.NO_KEYS,
	      			stimulus: "Thank you for participating in this experiment! <br><br> Please click the link below to complete a quick questionnaire about this study (required in order to receive credit for your participation). In this questionnaire, you will be also be asked to upload the DataFile.csv file that was just downloaded to your computer. <br><br> <a href='https://forms.gle/BvwTwjyWcizoHCFD6'> CLICK HERE FOR QUESTIONNAIRE </a>"
	      	    }
	      		]
	    }
	    timeline.push(debrief_block);

	    /* start the experiment */
	    jsPsych.init({
                     timeline: timeline,
                     preload_audio: audio,
                     preload_images: images,
                     show_preload_progress_bar: false,
                     use_webaudio: false
	    });

		
	</script>


</html>
